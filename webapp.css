:root{
      --bg: #0b0f14;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --stroke: rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.30);
      --ring-track: rgba(255,255,255,.08);

      --accent: #10b981;        /* emerald */
      --accent2: #34d399;
      --danger: #ef4444;
      --warn: #f59e0b;

      --r-card: 18px;
      --r-btn: 16px;
      --gap: 16px;
      --gap8: 8px;
      --nav-h: 64px;

      --safe-top: env(safe-area-inset-top);
      --safe-bot: env(safe-area-inset-bottom);

      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Arial, sans-serif;
    }

    /* Light theme fallback */
    [data-theme="light"]{
      --bg: #f4f6fa;
      --card: #ffffff;
      --card2: #eef2f7;
      --text: #111827;
      --muted: #4b5563;
      --muted2: #6b7280;
      --stroke: rgba(15,23,42,.12);
      --shadow: 0 10px 24px rgba(15,23,42,.10);
      --ring-track: rgba(15,23,42,.08);
    }

    *{ box-sizing: border-box; }
    html, body{
      height: 100%;
      margin: 0;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      overscroll-behavior: none;
    }

    a{ color: inherit; text-decoration: none; }
    button, input, select, textarea{
      font-family: var(--font);
      color: var(--text);
    }

    .app{
      min-height: 100%;
      padding: calc(var(--safe-top) + 12px) 14px calc(var(--nav-h) + var(--safe-bot) + 18px);
      max-width: 520px;
      margin: 0 auto;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 12px;
    }
    .monthClosedRow{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      margin: -6px 0 12px;
    }
    .monthTitle{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }
    .monthTitle .title{
      font-size: 18px;
      font-weight: 650;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 8px 10px;
      border-radius: 999px;
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: none;
    }
    .icon{
      font-family: "Material Symbols Rounded";
      font-weight: 500;
      font-style: normal;
      font-size: 22px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
    }
    .btnIcon{
      width: 42px; height: 42px;
      display:grid; place-items:center;
      border-radius: 14px;
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: none;
      padding: 0;
      cursor: pointer;
      transition: transform .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btnIcon:active{ transform: scale(.98); }

    .section{
      margin-top: 14px;
    }
    .sectionHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .sectionHeader h3{
      margin: 0;
      font-size: 14px;
      font-weight: 650;
      color: var(--muted);
      letter-spacing: .3px;
    }

    .grid2{
      display:grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 12px;
    }
    .attachmentGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .attachThumb,
    .attachSkeleton{
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      aspect-ratio: 1 / 1;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
    }
    .attachThumb{
      opacity: 0;
      transform: scale(.96);
      transition: opacity .18s ease, transform .18s ease;
      cursor: pointer;
    }
    .attachThumb.show{
      opacity: 1;
      transform: scale(1);
    }
    .attachThumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .attachRemove{
      position: absolute;
      top: 6px;
      right: 6px;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.35);
      background: rgba(15,23,42,.7);
      color: #fff;
      display: grid;
      place-items: center;
      cursor: pointer;
      padding: 0;
    }
    .attachRemove .icon{
      font-size: 16px;
    }
    .attachBadge{
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 4px 8px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
      background: rgba(17,24,39,.7);
      color: #fff;
      text-transform: uppercase;
      letter-spacing: .4px;
    }
    .attachIcon{
      position: absolute;
      right: 6px;
      bottom: 6px;
      color: rgba(255,255,255,.85);
      font-size: 18px;
    }
    .attachProgress{
      position: absolute;
      left: 0;
      bottom: 0;
      height: 3px;
      width: 0%;
      background: var(--accent);
      transition: width .1s linear;
    }
    .attachHint{
      margin-top: 8px;
    }
    .attachQueued{
      opacity: .75;
    }
    .amtRow{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: 6px;
    }
    .attachCount{
      display:inline-flex;
      align-items:center;
      gap: 4px;
      font-size: 12px;
      color: var(--muted);
    }
    .attachCount .icon{
      font-size: 16px;
    }
    .viewerModal .modal{
      max-width: 720px;
      width: calc(100% - 32px);
    }
    .viewerContent{
      position: relative;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.2);
      border-radius: 16px;
      padding: 10px;
      max-height: 70vh;
      overflow: auto;
    }
    .viewerContent img,
    .viewerContent iframe{
      max-width: 100%;
      max-height: 68vh;
      object-fit: contain;
      border-radius: 12px;
      border: 0;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--r-card);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card.allowOverflow{
      overflow: visible;
    }
    .collectionCard{
      padding: 0;
    }
    .collectionToggle{
      width: 100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 16px;
      background: transparent;
      border: 0;
      color: inherit;
      cursor: pointer;
      text-align: left;
      -webkit-tap-highlight-color: transparent;
    }
    .collectionToggle:active{ transform: scale(.99); }
    .collectionMeta{
      display:flex;
      flex-direction:column;
      gap: 4px;
      min-width: 0;
    }
    .collectionBody{
      padding: 0 12px;
      border-top: 1px solid var(--stroke);
      max-height: 0;
      opacity: 0;
      transform: translateY(-6px);
      overflow: hidden;
      transition: max-height .28s ease, opacity .2s ease, transform .2s ease, padding .2s ease;
    }
    .collectionCard.expanded .collectionBody{
      padding: 0 12px 12px;
      max-height: 2200px;
      opacity: 1;
      transform: translateY(0);
    }
    .collectionChevron{
      color: var(--muted);
      transition: transform .18s ease;
    }
    .collectionCard.expanded .collectionChevron{
      transform: rotate(180deg);
    }
    .segmented{
      display: inline-flex;
      gap: 6px;
      padding: 4px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--stroke);
    }
    .segBtn{
      border: 0;
      background: transparent;
      color: var(--muted);
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: background .12s ease, color .12s ease;
    }
    .segBtn.active{
      background: var(--card);
      color: var(--text);
    }
    .deltaBadge{
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      background: rgba(255,255,255,.08);
      color: var(--muted);
    }
    .deltaBadge.positive{
      background: rgba(16,185,129,.18);
      color: var(--accent2);
    }
    .deltaBadge.negative{
      background: rgba(239,68,68,.18);
      color: #fecaca;
    }
    .deltaBadge.neutral{
      background: rgba(255,255,255,.08);
      color: var(--muted);
    }
    .periodSelectors{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .periodTopList{
      display: grid;
      gap: 8px;
    }
    .periodTopItem{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      font-size: 12px;
    }
    .categoryCard .collectionToggle{
      gap: 10px;
      flex-wrap: wrap;
      width: auto;
      flex: 1;
    }
    .categoryHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      width: 100%;
      flex-wrap: wrap;
    }
    .budgetList{
      display:flex;
      flex-direction:column;
      gap: 10px;
      padding: 10px 0 2px;
    }
    .budgetRow{
      display:flex;
      flex-direction:column;
      gap: 6px;
      padding: 6px 4px;
      border-radius: 12px;
    }
    .budgetRow.warn{
      background: rgba(245,158,11,.08);
    }
    .budgetRow.over{
      background: rgba(239,68,68,.08);
    }
    .budgetMeta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
    }
    .budgetName{
      font-weight: 600;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .budgetValues{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }
    .budgetBar{
      height: 6px;
      border-radius: 999px;
      background: var(--ring-track);
      overflow: hidden;
    }
    .budgetBarFill{
      height: 100%;
      width: 0%;
      background: var(--accent);
      transition: width .2s ease;
    }
    .budgetRow.warn .budgetBarFill{
      background: var(--warn);
    }
    .budgetRow.over .budgetBarFill{
      background: var(--danger);
    }
    .budgetIndicator{
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .budgetIndicator.warn{
      border-color: rgba(245,158,11,.4);
      background: rgba(245,158,11,.08);
    }
    .budgetIndicator.over{
      border-color: rgba(239,68,68,.4);
      background: rgba(239,68,68,.08);
    }
    .budgetIndicatorMeta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .budgetIndicatorTitle{
      font-size: 12px;
      color: var(--muted);
    }
    .budgetIndicatorValue{
      font-size: 12px;
      color: var(--text);
      font-weight: 600;
      white-space: nowrap;
    }
    .budgetIndicatorHint{
      font-size: 11px;
      color: var(--muted2);
    }
    .budgetTable{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .budgetRowForm{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      align-items:end;
    }
    .budgetRowForm .btn{
      width: 100%;
    }
    .categoryMeta{
      display:flex;
      flex-direction:column;
      gap: 4px;
      min-width: 0;
    }
    .categoryActions{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items:center;
      justify-content:flex-end;
    }
    .categoryCount{
      font-size: 12px;
      color: var(--muted2);
    }
    .aliasList{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .aliasChip{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      font-size: 12px;
      animation: chipPop .14s ease;
    }
    .aliasChip button{
      border: 0;
      background: transparent;
      color: inherit;
      cursor: pointer;
      padding: 0;
      display:grid;
      place-items:center;
    }
    .aliasChip .icon{
      font-size: 16px;
    }
    @keyframes chipPop{
      from{ transform: scale(.92); opacity: .5; }
      to{ transform: scale(1); opacity: 1; }
    }
    .chip.selected{
      color: rgba(16,185,129,.95);
      border-color: rgba(16,185,129,.35);
      background: rgba(16,185,129,.12);
    }
    .metric{
      padding: 12px 12px 10px;
      min-height: 82px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      opacity: 0;
      transform: translateY(10px);
      animation: staggerIn .32s ease forwards;
    }
    .metric:nth-child(1){ animation-delay: .02s; }
    .metric:nth-child(2){ animation-delay: .08s; }
    .metric:nth-child(3){ animation-delay: .14s; }
    .metric:nth-child(4){ animation-delay: .20s; }

    @keyframes staggerIn{
      to{ opacity: 1; transform: translateY(0); }
    }
    .metric .label{
      font-size: 12px;
      color: var(--muted);
    }
    .metric .value{
      font-size: 18px;
      font-weight: 750;
      letter-spacing: .2px;
      margin-top: 6px;
    }
    .metric .sub{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 6px;
    }

    .bigCard{
      padding: 14px;
    }
    .miniCard{
      padding: 12px 14px;
    }
    .draftsCardBtn{
      width: 100%;
      background: transparent;
      border: none;
      color: inherit;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 0;
      cursor: pointer;
    }
    .draftCount{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(16,185,129,.14);
      border: 1px solid rgba(16,185,129,.28);
      font-size: 12px;
    }
    .row{
      display:flex;
      align-items:center;
      gap: 12px;
    }
    .rowBetween{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .muted{ color: var(--muted); }
    .muted2{ color: var(--muted2); }
    .tiny{ font-size: 12px; }
    .small{ font-size: 13px; }
    .bold{ font-weight: 700; }
    .mono{ font-variant-numeric: tabular-nums; }
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: var(--card2);
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }
    #expWarn{
      white-space: normal;
      max-width: 100%;
      line-height: 1.35;
      align-items: flex-start;
    }
    .badge.ok{ color: rgba(16,185,129,.95); border-color: rgba(16,185,129,.35); }
    .badge.warn{ color: rgba(245,158,11,.95); border-color: rgba(245,158,11,.35); }
    .badge.bad{ color: rgba(239,68,68,.95); border-color: rgba(239,68,68,.35); }
    .badge.lock{
      color: rgba(148,163,184,.95);
      border-color: rgba(148,163,184,.35);
      background: rgba(15,23,42,.3);
    }
    .btn.warn{
      background: linear-gradient(180deg, rgba(245,158,11,.95), rgba(245,158,11,.75));
      border-color: rgba(245,158,11,.35);
      color: #241100;
      font-weight: 750;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: var(--r-btn);
      border: 1px solid var(--stroke);
      background: var(--card);
      cursor: pointer;
      transition: transform .12s ease, background .12s ease;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .btn:active{ transform: scale(.98); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(16,185,129,.95), rgba(16,185,129,.75));
      border-color: rgba(16,185,129,.35);
      color: #062216;
      font-weight: 750;
    }
    .btn.danger{
      background: linear-gradient(180deg, rgba(239,68,68,.95), rgba(239,68,68,.75));
      border-color: rgba(239,68,68,.35);
      color: #fff;
      font-weight: 750;
    }
    .btn.ghost{
      background: transparent;
    }
    .btn.small{
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
    }

    .divider{
      height: 1px;
      background: var(--stroke);
      margin: 12px 0;
    }

    .chartWrap{
      height: 210px;
      padding-top: 6px;
    }
    .chartWrap.small{
      height: 190px;
    }
    canvas{
      width: 100% !important;
      height: 100% !important;
    }

    /* Progress ring (MНСП) */
    .ring{
      width: 96px;
      height: 96px;
      border-radius: 50%;
      background: conic-gradient(var(--accent) 0deg, var(--ring-track) 0deg);
      display:grid;
      place-items:center;
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      flex: 0 0 auto;
    }
    .ringInner{
      width: 74px;
      height: 74px;
      border-radius: 50%;
      background: var(--bg);
      display:grid;
      place-items:center;
      border: 1px solid var(--stroke);
    }
    .ringInner .pct{
      font-size: 14px;
      font-weight: 800;
    }
    .ringInner .cap{
      font-size: 10px;
      color: var(--muted2);
      margin-top: -2px;
    }

    /* Lists */
    .list{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .monitorItem{
      display:flex;
      align-items:flex-start;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(10px);
      animation: staggerIn .32s ease forwards;
    }
    .monitorItem .meta{
      min-width: 0;
      display:flex;
      flex-direction:column;
      gap: 4px;
    }
    .monitorItem .title{
      font-weight: 700;
      font-size: 14px;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .monitorItem .sub{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .levelIcon{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      border: 1px solid var(--stroke);
      background: var(--card2);
      color: var(--muted);
      flex: 0 0 auto;
    }
    .levelIcon.warn{
      color: var(--warn);
      border-color: rgba(245,158,11,.45);
      background: rgba(245,158,11,.12);
    }
    .levelIcon.danger{
      color: var(--danger);
      border-color: rgba(239,68,68,.45);
      background: rgba(239,68,68,.12);
    }
    .levelIcon.success{
      color: var(--accent);
      border-color: rgba(16,185,129,.45);
      background: rgba(16,185,129,.12);
    }
    .monitorOverview{
      position: relative;
      overflow: hidden;
    }
    .monitorOverview.shimmer::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.08) 20%, transparent 40%);
      animation: shimmer 1.1s ease;
    }
    .miniStat{
      padding: 10px 12px;
      border-radius: 14px;
      background: var(--card2);
      border: 1px solid var(--stroke);
    }
    .miniStat .label{
      font-size: 12px;
      color: var(--muted2);
    }
    .miniStat .value{
      margin-top: 6px;
      font-size: 16px;
      font-weight: 700;
    }
    .detailBlock{
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      font-size: 12px;
      line-height: 1.4;
      white-space: pre-wrap;
      word-break: break-word;
    }
    @keyframes shimmer{
      from{ transform: translateX(-60%); }
      to{ transform: translateX(60%); }
    }
    .backupItem{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      animation: backupFade .22s ease;
      padding: 12px;
      border-radius: 16px;
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
    }
    .backupItem.highlight{
      animation: backupFade .22s ease, backupHighlight 1s ease;
    }
    .backupMeta{
      display:flex;
      flex-direction:column;
      gap: 4px;
      min-width: 0;
    }
    .backupMeta .title{
      font-weight: 700;
      font-size: 14px;
      line-height: 1.25;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .backupMeta .subtitle{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .backupDownloadBtn{
      flex: 0 0 auto;
    }
    .backupDropdown{
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: var(--card);
      overflow: hidden;
    }
    .backupDropdownHeader{
      width: 100%;
      border: none;
      background: transparent;
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: var(--text);
      font-weight: 650;
      cursor: pointer;
      transition: background .18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .backupDropdownHeader:active{
      background: rgba(255,255,255,.04);
    }
    .backupDropdownHeader .muted2{
      font-size: 12px;
    }
    .backupDropdownHeader .icon{
      transition: transform .22s ease;
    }
    .backupDropdown.open .backupDropdownHeader .icon{
      transform: rotate(180deg);
    }
    .backupDropdownBody{
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transform: translateY(-6px);
      transition: max-height .28s ease, opacity .2s ease, transform .28s ease;
    }
    .backupDropdown.open .backupDropdownBody{
      max-height: 320px;
      opacity: 1;
      transform: translateY(0);
    }
    .backupListScroll{
      max-height: 280px;
      overflow-y: auto;
      padding: 8px 10px 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .backupListScroll::-webkit-scrollbar{
      width: 6px;
    }
    .backupListScroll::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.12);
      border-radius: 99px;
    }
    .backupListScroll::-webkit-scrollbar-track{
      background: transparent;
    }
    .filePicker{
      position: relative;
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: var(--card);
    }
    .fileInput{
      position: absolute;
      opacity: 0;
      pointer-events: none;
      width: 0;
      height: 0;
    }
    .filePickMeta{
      min-width: 0;
      display:flex;
      flex-direction:column;
      gap: 4px;
    }
    .filePickName{
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    .filePickHint{
      font-size: 12px;
      color: var(--muted2);
    }
    @keyframes backupFade{ from{opacity:0; transform: translateY(4px);} to{opacity:1; transform: translateY(0);} }
    @keyframes backupHighlight{ 0%{ background: var(--card2);} 100%{ background: var(--card);} }
    .item{
      padding: 12px;
      border-radius: var(--r-card);
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      cursor: pointer;
      transition: transform .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .item:active{ transform: scale(.99); }
    .itemLeft{
      display:flex;
      align-items:flex-start;
      gap: 10px;
      min-width: 0;
    }
    .itemIco{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: rgba(16,185,129,.12);
      border: 1px solid rgba(16,185,129,.20);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
    }
    .itemIco .icon{ color: var(--accent2); font-size: 22px; }
    .itemText{
      min-width: 0;
    }
    .itemText .t{
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .itemText .s{
      font-size: 12px;
      color: var(--muted);
      margin-top: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .itemRight{
      text-align:right;
      flex: 0 0 auto;
    }
    .itemRight .amt{
      font-weight: 800;
      font-size: 14px;
    }
    .itemRight .dt{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 3px;
    }
    .settingsMenuList{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .settingsMenu{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .settingsMenuHeader{
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px 14px;
      border-radius: 18px;
      background: color-mix(in srgb, var(--card) 88%, transparent);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
    }
    .settingsMenuTitle{
      font-weight: 700;
      font-size: 16px;
      letter-spacing: .2px;
    }
    .settingsMenuItem{
      width: 100%;
      text-align: left;
      border: 1px solid var(--stroke);
      background: var(--card);
    }
    .settingsMenuItem .itemRight .icon{
      font-size: 20px;
      color: var(--muted2);
    }
    .settingsPanel{
      position: fixed;
      inset: 0;
      z-index: 60;
      display:flex;
      justify-content:center;
      padding: 0;
      pointer-events:none;
    }
    .settingsPanel.open{
      pointer-events:auto;
    }
    .settingsPanelBackdrop{
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(10px);
      opacity: 0;
      transition: opacity .22s ease;
    }
    .settingsPanel.open .settingsPanelBackdrop{
      opacity: 1;
    }
    .settingsPanelContent{
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: none;
      margin: 0;
      min-height: 100dvh;
      background: color-mix(in srgb, var(--bg) 72%, rgba(0,0,0,.35));
      display:flex;
      flex-direction:column;
      padding: calc(var(--safe-top) + 12px) 14px calc(var(--safe-bot) + 12px);
      opacity: 0;
      transform: translateX(14px);
      transition: transform .22s ease, opacity .22s ease;
      pointer-events:none;
    }
    .settingsPanel.open .settingsPanelContent{
      opacity: 1;
      transform: translateX(0);
      pointer-events:auto;
    }
    .settingsPanelHeader{
      position: sticky;
      top: 0;
      z-index: 2;
      display:grid;
      grid-template-columns: 42px 1fr 42px;
      align-items:center;
      gap: 12px;
      padding: 10px 12px;
      margin-bottom: 12px;
      border-radius: 18px;
      background: color-mix(in srgb, var(--card) 88%, transparent);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
    }
    .settingsPanelHeader::after{
      content: "";
      width: 42px;
      height: 42px;
    }
    .settingsPanelHeader .btnIcon{
      border-radius: 14px;
      background: color-mix(in srgb, var(--card2) 85%, transparent);
    }
    .settingsPanelTitle{
      font-weight: 700;
      font-size: 16px;
      letter-spacing: .2px;
      text-align: center;
    }
    .settingsPanelBody{
      flex: 1;
      overflow: auto;
      padding-top: 8px;
    }
    .settingsPanelBody .section{
      margin-top: 0;
    }
    .spinner{
      width: 16px;
      height: 16px;
      border: 2px solid var(--muted);
      border-top-color: var(--accent);
      border-radius: 50%;
      display:inline-block;
      animation: spin .8s linear infinite;
    }
    .spinner.hidden{ display:none; }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* Bottom nav */
    .nav{
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      padding: 10px 14px calc(10px + var(--safe-bot));
      background: color-mix(in srgb, var(--bg) 88%, transparent);
      backdrop-filter: blur(18px);
      border-top: 1px solid var(--stroke);
      z-index: 50;
    }
    .navInner{
      max-width: 520px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      height: calc(var(--nav-h) - 20px);
    }
    .navInner.centered{
      display:flex;
      justify-content:center;
      gap: 12px;
    }
    .navInner.centered .navBtn{
      flex: 0 0 auto;
      min-width: 92px;
    }
    .navBtn{
      border: 1px solid transparent;
      background: transparent;
      border-radius: 16px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 2px;
      cursor: pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      -webkit-tap-highlight-color: transparent;
      padding: 6px 0;
    }
    .navBtn:active{ transform: scale(.98); }
    .navBtn .icon{ font-size: 24px; color: var(--muted); }
    .navBtn .lbl{ font-size: 11px; color: var(--muted); }
    .navBtn.active{
      background: rgba(16,185,129,.12);
      border-color: rgba(16,185,129,.25);
    }
    .navBtn.active .icon,
    .navBtn.active .lbl{
      color: rgba(16,185,129,.95);
      font-weight: 650;
    }

    /* Screens + transitions */
    .screen{
      display:none;
      opacity: 0;
      transform: translateX(14px);
    }
    .screen.active{
      display:block;
      animation: screenIn .20s ease forwards;
    }
    @keyframes screenIn{
      to { opacity: 1; transform: translateX(0); }
    }

    /* Forms */
    .form{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 0;
    }
    .field label{
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .2px;
    }
    .input{
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: var(--card);
      padding: 12px 12px;
      font-size: 15px;
      outline: none;
      width: 100%;
      min-width: 0;
    }
    .input:focus{
      border-color: rgba(16,185,129,.35);
      box-shadow: 0 0 0 3px rgba(16,185,129,.12);
    }
    .input[readonly]{ color: var(--muted); }
    .input.hiddenSelect{
      display: none;
    }

    .dropdown{
      position: relative;
      z-index: 1;
    }
    .dropdown.open{
      z-index: 5;
    }
    .dropdownTrigger{
      width: 100%;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: var(--card);
      padding: 12px 12px;
      font-size: 15px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: var(--text);
      cursor: pointer;
      transition: border-color .18s ease, box-shadow .18s ease, background .18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .dropdown.open .dropdownTrigger{
      border-color: rgba(16,185,129,.35);
      box-shadow: 0 0 0 3px rgba(16,185,129,.12);
    }
    .dropdownTrigger:focus-visible{
      outline: none;
      border-color: rgba(16,185,129,.35);
      box-shadow: 0 0 0 3px rgba(16,185,129,.12);
    }
    .dropdownTrigger .icon{
      font-size: 20px;
      color: var(--muted);
      transition: transform .2s ease;
    }
    .dropdown.open .dropdownTrigger .icon{
      transform: rotate(180deg);
    }
    .dropdownPanel{
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      right: 0;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 6px;
      display:flex;
      flex-direction:column;
      gap: 4px;
      max-height: 0;
      opacity: 0;
      transform: translateY(-6px) scale(.98);
      overflow: hidden;
      pointer-events: none;
      transition: max-height .24s ease, opacity .18s ease, transform .18s ease;
      z-index: 200;
    }
    .dropdown.open-up .dropdownPanel{
      top: auto;
      bottom: calc(100% + 6px);
      transform: translateY(6px) scale(.98);
    }
    .dropdown.open .dropdownPanel{
      max-height: 260px;
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
      overflow-y: auto;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }
    .dropdown.open-up.open .dropdownPanel{
      transform: translateY(0) scale(1);
    }
    .dropdownOption{
      border: 1px solid transparent;
      background: transparent;
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      text-align: left;
      cursor: pointer;
      transition: background .16s ease, border-color .16s ease, transform .16s ease;
    }
    .dropdownOption:hover{
      background: var(--card2);
    }
    .dropdownOption:active{
      transform: scale(.99);
    }
    .dropdownOption[aria-selected="true"]{
      background: rgba(16,185,129,.12);
      border-color: rgba(16,185,129,.25);
      color: rgba(16,185,129,.95);
      font-weight: 600;
    }
    @media (prefers-reduced-motion: reduce){
      .dropdownPanel,
      .dropdownTrigger,
      .dropdownOption{
        transition: none;
      }
    }

    .tabs{
      display:flex;
      gap: 10px;
      padding: 6px;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      margin-bottom: 12px;
    }
    .tab{
      flex:1;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      font-weight: 700;
      cursor: pointer;
      transition: background .12s ease, transform .12s ease;
    }
    .tab:active{ transform: scale(.98); }
    .tab.active{
      background: rgba(16,185,129,.12);
      border-color: rgba(16,185,129,.25);
      color: rgba(16,185,129,.95);
    }

    .chips{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .tagChips{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
      align-items:center;
    }
    .tagChip{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      color: var(--text);
      font-size: 12px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .tagChip button{
      border: 0;
      background: transparent;
      color: var(--muted2);
      padding: 0;
      margin: 0;
      cursor: pointer;
    }
    .tagChipMini{
      display:inline-flex;
      align-items:center;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      color: var(--muted);
      font-size: 11px;
      max-width: 140px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .tagChipMini.more{
      color: var(--muted2);
    }
    .itemTags{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      white-space: normal;
    }
    .tagPickerRow{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: var(--card);
    }
    .tagPickerRow input{
      width: 18px;
      height: 18px;
    }
    .tagPickerRow span{
      font-size: 14px;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      background: var(--card2);
      border: 1px solid var(--stroke);
      color: var(--muted);
      font-size: 12px;
      cursor: pointer;
      transition: transform .12s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .chip:active{ transform: scale(.98); }
    .chip.ok{
      color: rgba(16,185,129,.95);
      border-color: rgba(16,185,129,.35);
      background: rgba(16,185,129,.12);
    }
    .chip.bad{
      color: rgba(239,68,68,.95);
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.12);
    }

    .stickyActions{
      position: fixed;
      left: 0; right: 0;
      bottom: calc(var(--nav-h) + var(--safe-bot));
      padding: 10px 14px;
      z-index: 40;
      pointer-events: none;
    }
    .stickyInner{
      max-width: 520px;
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap: 8px;
      pointer-events: auto;
    }
    #addDonationWrap,
    #addExpenseWrap{
      padding-bottom: calc(var(--nav-h) + var(--safe-bot) + 220px);
    }

    /* Modal */
    .modalBackdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index: 80;
      padding: 12px 14px calc(14px + var(--safe-bot));
    }
    .modalBackdrop.show{ display:flex; animation: fadeIn .18s ease; }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
    .modal{
      width: min(520px, 100%);
      background: color-mix(in srgb, var(--bg) 70%, rgba(0,0,0,.15));
      border: 1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(10px);
      animation: sheetUp .20s ease forwards;
      display: flex;
      flex-direction: column;
      max-height: calc(100dvh - 24px - var(--safe-top) - var(--safe-bot));
    }
    @keyframes sheetUp{ to{ transform: translateY(0); } }
    .modalBackdrop.draftModal .modal{
      animation: sheetUp220 .22s ease forwards;
    }
    @keyframes sheetUp220{ to{ transform: translateY(0); } }
    .modalHeader{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid var(--stroke);
    }
    .modalHeader .h{
      font-weight: 800;
      letter-spacing: .2px;
    }
    .modalBody{
      padding: 14px;
      overflow-y: auto;
      overscroll-behavior: contain;
    }
    /* Success overlay */
    .toast{
      position: fixed;
      left: 0; right: 0;
      top: calc(var(--safe-top) + 12px);
      display:flex;
      justify-content:center;
      z-index: 120;
      pointer-events:none;
    }
    .toastCard{
      pointer-events:none;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(16,185,129,.14);
      border: 1px solid rgba(16,185,129,.22);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .toastCard.show{
      opacity: 1;
      transform: translateY(0);
    }
    .check{
      width: 22px; height: 22px;
      border-radius: 50%;
      border: 2px solid rgba(16,185,129,.85);
      position: relative;
    }
    .check:after{
      content:"";
      position:absolute;
      width: 6px; height: 12px;
      border-right: 2px solid rgba(16,185,129,.95);
      border-bottom: 2px solid rgba(16,185,129,.95);
      transform: rotate(45deg);
      left: 7px; top: 2px;
      opacity: 0;
      animation: tick .36s ease forwards;
    }
    @keyframes tick{
      to{ opacity: 1; }
    }

    /* Helpers */
    .hidden{ display:none !important; }
    .spacer8{ height: 8px; }
    .spacer12{ height: 12px; }
    .right{ text-align:right; }

    .draftList{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .draftItem{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      transition: height .18s ease, opacity .18s ease, margin .18s ease, padding .18s ease;
      overflow: hidden;
    }
    .draftItem.removing{
      opacity: 0;
      padding-top: 0;
      padding-bottom: 0;
      margin-top: 0;
      margin-bottom: 0;
    }
    .draftMain{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .draftTitle{
      font-weight: 700;
      letter-spacing: .2px;
    }
    .draftMeta{
      color: var(--muted);
      font-size: 12px;
      margin-top: 4px;
    }
    .draftAmount{
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }
    .draftActions{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .closedCard{
      text-align: center;
    }
    .closedCard .icon{
      font-size: 32px;
      color: var(--muted);
    }
    .shake{
      animation: cardShake 220ms ease-in-out;
    }
    @keyframes cardShake{
      0%{ transform: translateX(0); }
      25%{ transform: translateX(-6px); }
      50%{ transform: translateX(6px); }
      75%{ transform: translateX(-4px); }
      100%{ transform: translateX(0); }
    }

    /* Small screens */
    @media (max-width: 360px){
      .grid2{ grid-template-columns: 1fr; }
      .chartWrap{ height: 190px; }
      .ring{ width: 90px; height: 90px; }
      .ringInner{ width: 70px; height: 70px; }
    }
